/* piewpiew-backbone-0.0.2.min.js */
(function(a,b){typeof define=="function"&&define.amd?define(["underscore","backbone","piewpiew"],function(c,d,e){return b(a,c,d,e)}):a.piewpiew.backbone=b(a,_,Backbone,piewpiew)})(this,function(a,b,c,d){return d.View=c.View.extend({template:"No template specified for view",templateFunction:function(a,b){return d.View.template(a,b)},templateContext:function(){return this.model&&typeof this.model.toJSON=="function"?this.model.toJSON():{}},render:function(){return $(this.el).html(this.templateFunction(this.template,this.templateContext())),this},onRegister:function(a){return this}}),d.ViewHelpers={editorForModel:function(a,b){var c=["<form>"];for(var d in a.fields)c.push(this.editorForField(a,a.fields[d]));return c.push("</form>"),c.join("")},editorForField:function(a,b,c){c||(c={});for(var d in a.fields)if(a.fields[d]==b){var e=a.get(d);return c.value=e,a.fields[d].editor(a.cid+"."+d,c)}},textfieldFor:function(a,b,c){console.log("textfield for ",a)},labelFor:function(a,b,c){console.log(a)},textfield:function(a,b){return d.printf('<input type="text" value="${value}"/>',b)}},d.View.template=function(a,c){return b.template(a,c)},d.App=c.View.extend({initialize:function(a,c){if(d.App.instanceMap[a])throw"App instance with key '"+a+"' already exists.";d.App.instanceMap[a]=this,c=c||{};var e;if(e=this.defaults)typeof e=="function"&&(e=e.call(this)),c=b.extend({},e,c);return this._multitonKey=a,this._routerMap={},this._modelMap={},this._viewMap={},this.initializeOptions(c),this.initializeRouter(),this.initializeModel(),this.initializeView(),this.initializeController(),this},initializeOptions:function(a){b.extend(this,a)},initializeRouter:function(){if(this.routes){var a=this.normalizeRoutes(this.routes);this.registerRouter("default",new c.Router({routes:a}))}return this},initializeModel:function(){return this},initializeView:function(){return this},initializeController:function(){return this},registerRouter:function(a,b){this._routerMap[a]=b},normalizeRoutes:function(a){if(this.baseUrl){normalizedRoutes={};for(var b in a){var c=b.length?this.baseUrl+"/"+b:this.baseUrl;normalizedRoutes[c]=a[b]}return normalizedRoutes}return a},getRouter:function(a){return this._routerMap[a]},registerModel:function(a,b){return this._modelMap[a]=b,b.app=this,typeof b.onRegister=="function"&&b.onRegister(this),this},getModel:function(a){return this._modelMap[a]},registerView:function(a,b){return this._viewMap[a]=b,b.app=this,typeof b.onRegister=="function"&&b.onRegister(this),this},getView:function(a){return this._viewMap[a]},registerCommand:function(a,b,c){var d=this;return b.bind(c,function(){var b=new a(d);b.execute.apply(b,arguments)}),this}}),d.App.instanceMap={},d.SimpleCommand=d.Class({initialize:function(a){this.app=a},execute:function(){return this}}),d.MacroCommand=d.Class({initialize:function(a){this.app=a,this.subCommands=[],this.initializeMacroCommand()},initializeMacroCommand:function(){return this},addSubCommand:function(a){return this.subCommands.push(a),this},execute:function(){while(this.subCommands.length>0){var a=this.subCommands.shift(),b=new a(this.app);b.execute.apply(b,arguments)}return this}}),d}),function(a,b){typeof define=="function"&&define.amd?define(["underscore","backbone","piewpiew"],function(c,d,e){return b(a,c,d,e)}):a.piewpiew.backbone=b(a,_,Backbone,piewpiew)}(this,function(a,b,c,d){return d.data||(d.data={}),d.data.fields||(d.data.fields={}),d.data.fields.Field=d.Class({required:!1,requiredMessage:"This is a required field",invalidTypeMessage:"The value of this field is invalid",initialize:function(a){a||(a={}),b.extend(this,a),this.validators=this.defaultValidators(),b.extend(this.validators,a.validators)},defaultValidators:function(){return{}},validate:function(a){var c=[];return this.validateType(a)||c.push(this.invalidTypeMessage),this.required&&!this.validateRequired(a)&&c.push(this.requiredMessage),b.each(this.validators,function(b,d){var e=b.validate(a);null!=e&&(c=c.concat(e))}),c.length>0?c:!1},validateType:function(a){return!0},validateRequired:function(a){return null==a?!1:!0}}),d.data.fields.StringField=d.data.fields.Field.extend({invalidTypeMessage:"The value of this field must be a string",validateType:function(a){return typeof a=="string"},validateRequired:function(a){return a.length>0}}),d.data.fields.EmailField=d.data.fields.StringField.extend({defaultValidators:function(){return{email:new d.data.validators.EmailValidator}}}),d.data.validators||(d.data.validators={}),d.data.validators.Validator=d.Class({initialize:function(a){a||(a={}),a.messages||(a.messages={}),b.extend(this,a),this.messages=this.defaultMessages(),b.extend(this.messages,a.messages)},defaultMessages:function(){return{}},validate:function(a){return[]}}),d.data.validators.StringValidator=d.data.validators.Validator.extend({minLength:-1,maxLength:-1,defaultMessages:function(){return{tooLongNoMinLength:"String must have no more than ${maxLength} characters",tooShortNoMaxLength:"String must have at least ${minLength} characters",outOfRange:"String must have between ${minLength} and ${maxLength} characters"}},validate:function(a){var b=[];return this.maxLength>-1&&a.length>this.maxLength&&b.push(this.minLength>-1?d.printf(this.messages.outOfRange,this):d.printf(this.messages.tooLongNoMinLength,this)),this.minLength>-1&&a.length<this.minLength&&b.push(this.maxLength>-1?d.printf(this.messages.outOfRange,this):d.printf(this.messages.tooShortNoMaxLength,this)),b}}),d.data.validators.RangeValidator=d.data.validators.Validator.extend({min:0,max:-1,defaultMessages:function(){return{outOfRange:"A value between ${min} and ${max} is required."}},validate:function(a){var b=[];return this.max<this.min?b:((a<this.min||a>this.max)&&b.push(d.printf(this.messages.outOfRange,{min:this.min,max:this.max})),b)}}),d.data.validators.RegexValidator=d.data.validators.Validator.extend({regex:/./,defaultMessages:function(){return{invalid:"The supplied string does not match the regular expression."}},validate:function(a){var b=[];return this.regex.test(a)||b.push(d.printf(this.messages.invalid,{value:a})),b}}),d.data.validators.EmailValidator=d.data.validators.RegexValidator.extend({regex:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,defaultMessages:function(){return{invalid:"${value} is not a valid email address."}}}),d.Model=c.Model.extend({initialize:function(a,b){console.log(a,b)},validate:function(a){var c={},d=!0,e=this;b.each(a,function(a,b){console.log("validating ",b,a);if(e.fields[b]){console.log(e.fields);var f=e.fields[b].validate(a);console.log("validated ",f),f&&(d=!1,c[b]=f)}});if(!d)return c}}),d})