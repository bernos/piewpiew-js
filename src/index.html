<html>
<head>
	<title></title>

	<script type="text/html" id="template-form">
	  <form>
	  	<%= Html.editorForModel(model) %>
	  	<input type="submit" value="save"/>
	  </form>
	</script>


	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript" src="underscore-backbone.min.js"></script>
	<script type="text/javascript" src="piewpiew.core.js"></script>
	<script type="text/javascript" src="piewpiew.backbone.js"></script>
	<script type="text/javascript" src="piewpiew.backbone.models.js"></script>
	<script type="text/javascript" src="piewpiew.backbone.views.js"></script>
	<script type="text/javascript">
		

		Person = piewpiew.models.Model.extend({
			fields: {
				
				firstName : new piewpiew.models.fields.StringField({
					label: "First name",
					validators: {
						length: new piewpiew.models.validators.StringValidator({
							minLength: 2,
							maxLength: 6
						})
					}		
				}),

				lastName : new piewpiew.models.fields.StringField({
					label: "Last name",
					validators: {
						length: new piewpiew.models.validators.StringValidator({
							minLength: 2,
							maxLength: 6
						})
					}					
				})
			}
		});

		FormView = piewpiew.views.View.extend({

			template: $('#template-form').html(),

			initialize: function(options) {
				if (this.model) {
					this.model.bind("error", this.handleError, this);
				}	
			},

			templateContext: function() {
				return {
					model:this.model
				};
			},

			events: {
				'submit form': 'handleSubmit' 
			},

			handleSubmit: function(e) {
				var formData = this.$('form').serializeObject();

				if (null != this.model) {
					if (this.model.set(formData)) this.trigger("submit", this);
				}			

				e.preventDefault();
			},

			handleError: function(model, error) {
				// TODO: show form errors
				console.log("ERROR", arguments);

				// Strategy should be... if there is already an element with a classname
				// error-for-<element name> then we will set its inner html
			},

			clearErrors: function() {
				
			},

			clearError: function(elementName) {
				
			}
		});

		Application = piewpiew.Application.extend({
			initializeModel: function() {
				this.registerModel('model', new Person({
					firstName: "Barry",
					lastName: "Smith"
				}));	
			},

			initializeView: function() {
				this.registerView('view', new FormView({
					model: this.getModel('model')
				}).bind("submit", function(formView) {
					console.log("You submitted ", formView);
				}));
			},

			startup: function() {
				$(this.el).append(this.getView('view').render().$el);
			}
		});

	</script>

	
</head>
<body>
	


	<script type="text/javascript">

		$(function() {
			var app = new Application().startup();
		});

		

		$("#create-person-form").submit(function() {
			var values = $(this).serializeObject();

			var p = new Person();
			p.set(values);

			return false;
		});
	</script>
</body>
</html>